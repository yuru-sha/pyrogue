# PyRogue Phase 2 開発タスク

このドキュメントは、PyRogue v0.1.0リリース後のPhase 2開発タスクを管理します。

## プロジェクト現状（v0.1.0完成）

PyRogueは2025年7月17日にバージョン0.1.0として完全に機能するローグライクゲームが完成しました。

### ✅ Phase 1完了項目

**アーキテクチャ基盤**:
- ✅ Handler Patternによるモジュラー設計実装
- ✅ CLI/GUI統合システム完成
- ✅ 包括的テストスイート（285単体テスト + 25CLI統合テスト）
- ✅ 品質保証プロセス確立

**ゲーム機能**:
- ✅ 完全なローグライクゲーム体験
- ✅ オリジナルRogue準拠の26階層ダンジョン
- ✅ IDベースセーブシステム
- ✅ 多様なモンスターAI・アイテムシステム
- ✅ Permadeathシステム・スコアランキング

**詳細**: Phase 1の完全な実装履歴は `docs/task-phase1.md` を参照

## Phase 2 開発方針

### 目標
1. **ゲーム体験の向上**: プレイアビリティとバランス調整
2. **品質の向上**: パフォーマンス最適化とUI/UX改善
3. **オリジナルRogue準拠**: 1980年版の忠実な再現

### 設計原則
- **安定性優先**: v0.1.0の堅牢な基盤を維持
- **オリジナル準拠**: 後追いのローグライクで追加された機能は追加しない
- **後方互換性**: 既存セーブデータとの互換性維持

## 🎯 Phase 2 タスクリスト

### 優先度：最高（ゲームバランス・体験向上）

#### 🎮 ゲームバランス改善
- [x] **飢餓システムの最適化** ✅ 完了（2025-07-17）
  - [x] 現在の設定値の検証とデータ収集
  - [x] プレイテスト結果に基づく調整
  - [x] 食料アイテムの出現頻度調整（深い階層での段階的増加）
  - [x] 飢餓ペナルティの段階的緩和（減少間隔12→14ターン）
  - [x] 初期食料増加（Food Ration 2→3個）

- [x] **戦闘バランス調整** ✅ 完了（2025-07-18）
  - [x] モンスター強度の階層別調整（経験値10倍化、階層別出現テーブル再構築）
  - [x] 武器・防具の効果値見直し（モンスター強化に対応した装備強化）
  - [x] レベルアップ時のHP・能力値増加調整（HP+8、攻撃+3、防御+2）
  - [x] アミュレット奪還時の難易度バランス（存在しないモンスター修正、最強クラス配置）

#### 🎨 UI/UX向上
- [x] **ヘルプシステム拡張** ✅ 完了（2025-07-18）
  - [x] より詳細なゲーム説明（6セクション構成：概要・操作・戦闘・アイテム・攻略・ステータス）
  - [x] 初心者向けチュートリアルモード（ゲーム開始時クイックガイド表示）
  - [x] コマンド一覧の整理・分類（状況に応じた動的ヒント表示）
  - [x] ゲーム目標の明確化（アミュレット探索進捗表示）
  - [x] メインメニューヘルプアクセス（簡単な参照システム）

- [x] **視覚的改善** ✅ 完了（2025-07-18）
  - [x] より直感的なステータス表示（ゲーム進捗・アミュレット状況表示）
  - [x] 初心者向けガイダンス（レベル1-3限定のコマンドヒント）

### 優先度：高（オリジナルRogue準拠改善）

#### 🗺️ ダンジョン生成の最適化
- [x] **パフォーマンス最適化システム** ✅ 完了（2025-07-18）
  - [x] DungeonProfiler実装（セクション別パフォーマンス計測）
  - [x] TileBufferシステム（バッファリング最適化）
  - [x] DungeonOptimizer（階層別パラメータ最適化）
  - [x] MemoryOptimizer（メモリ使用量最適化）
  - [x] ValidationOptimizer（検証レベル動的調整）

- [x] **BSPアルゴリズム改善** ✅ 完了（2025-07-18）
  - [x] 部屋配置の最適化（RoomPlacementOptimizer実装・階層別配置戦略・5種類のパターン）
  - [x] 廊下生成の改善（AdvancedCorridorGenerator実装・6種類の廊下パターン・階層別複雑度）
  - [x] デッドエンドの適切な配置（DeadEndManager実装・戦略的配置・5種類のデッドエンドタイプ）

- [x] **階層難易度調整** ✅ 完了（2025-07-18）
  - [x] 階層別モンスター出現率の調整
  - [x] アイテム出現バランスの最適化
  - [x] トラップ配置の改善

#### 🏺 アイテムシステム調整
- [x] **識別システム改善** ✅ 完了（2025-07-18）
  - [x] オリジナルRogue準拠の識別動作
  - [x] 未識別アイテムの適切な表示
  - [x] 識別状態の保存・復元

- [x] **アイテムバランス調整** ✅ 完了（2025-07-18）
  - [x] 武器・防具の効果値調整
  - [x] ポーション・巻物の効果調整
  - [x] 出現頻度の最適化

#### 👹 モンスターAI改善
- [ ] **基本AI動作の最適化**
  - [ ] 追跡・逃走行動の改善
  - [ ] 視界システムの最適化
  - [ ] 戦闘行動の調整

- [ ] **階層別モンスター調整**
  - [ ] 強度バランスの見直し
  - [ ] 特殊能力の調整
  - [ ] 出現パターンの最適化

### 優先度：中（システム機能向上）

#### ⚙️ システム機能拡張
- [ ] **パフォーマンス最適化**
  - [ ] 描画処理の最適化
  - [ ] メモリ使用量の削減
  - [ ] 起動時間の短縮

- [ ] **バグ修正・安定性向上**
  - [ ] エラーハンドリングの改善
  - [ ] セーブ・ロード処理の安定性向上
  - [ ] メモリリークの修正

#### 🔍 デバッグ・開発支援
- [ ] **デバッグ機能改善**
  - [ ] ウィザードモードの機能拡張
  - [ ] パフォーマンス計測ツール
  - [ ] 自動テストプレイ機能

- [ ] **ツール・ユーティリティ**
  - [ ] セーブデータ分析ツール
  - [ ] ダンジョン生成パラメータ調整ツール
  - [ ] バランス調整支援ツール

### 優先度：低（将来的拡張）

#### 📊 データ・分析基盤
- [ ] **プレイデータ収集**
  - [ ] プレイ行動ログ収集
  - [ ] バランス分析データ
  - [ ] A/Bテスト基盤

## 🔄 開発ワークフロー

### Phase 2開発原則
1. **品質優先**: 各機能は完全なテストカバレッジを持つ
2. **段階的リリース**: 機能単位でのマイナーバージョンアップ
3. **プレイテスト重視**: 実際のゲーム体験に基づく調整
4. **オリジナル準拠**: 1980年版Rogueの忠実な再現を最優先

### リリース計画
- **v0.2.0**: ゲームバランス改善 + UI/UX向上
- **v0.3.0**: ダンジョン生成最適化
- **v0.4.0**: アイテムシステム調整
- **v0.5.0**: モンスターAI改善

### 品質管理
```bash
make qa-after-feature   # 新機能追加後の品質チェック
make qa-all            # 包括的品質確認
```

## 📋 進行状況管理

### 現在のステータス
- **Phase 1**: ✅ 完了（v0.1.0リリース済み）
- **Phase 2**: 🚀 進行中（7/8マイルストーン完了）
  - ✅ 飢餓システム最適化
  - ✅ 戦闘バランス調整
  - ✅ UI/UX向上
  - ✅ BSPアルゴリズム改善
  - ✅ 階層難易度調整
  - ✅ GUI/CLIモード統合修正
  - ✅ アイテムシステム調整
  - 🔄 モンスターAI改善（進行予定）

### 完了したマイルストーン
1. ✅ **飢餓システム最適化** (2025-07-17)
   - 初期食料増加（Food Ration 2→3個）
   - 深い階層での食料出現率向上（10階層以降段階的増加）
   - 満腹度減少間隔緩和（12→14ターン）
   - 品質保証：単体テスト285/285、CLI統合テスト25/25成功

2. ✅ **戦闘バランス調整** (2025-07-18)
   - モンスター経験値10倍化（計算式「レベル×10+HP+攻撃×2+防御×3」）
   - 階層別出現テーブル再構築（B1-26F全体の難易度曲線最適化）
   - 武器・防具効果値強化（モンスター強化に対応した装備バランス）
   - レベルアップ成長強化（HP+8、攻撃+3、防御+2）
   - アミュレット奪還時の最強モンスター配置修正
   - 品質保証：単体テスト285/285、CLI統合テスト25/25成功

3. ✅ **UI/UX向上** (2025-07-18)
   - 包括的ヘルプメニューシステム実装（6セクション：概要・操作・戦闘・アイテム・攻略・ステータス）
   - 新規プレイヤー向けクイックガイド（ゲーム開始時自動表示）
   - レベル1-3プレイヤー向け動的コマンドヒント
   - アミュレット探索進捗とゲーム目標の明確な表示
   - メインメニューからのヘルプアクセス
   - 詳細なステータス効果・戦闘統計説明
   - 品質保証：単体テスト285/285、CLI統合テスト25/25成功

4. ✅ **BSPアルゴリズム改善** (2025-07-18)
   - RoomPlacementOptimizer実装（階層別配置戦略：中央寄せ・端寄せ・角配置・黄金比・ランダム）
   - AdvancedCorridorGenerator実装（6種類の廊下パターン：直接・曲線・ジグザグ・分岐・景観・標準L字）
   - DeadEndManager実装（5種類のデッドエンドタイプ：シンプル・アルコーブ・ニッチ・チャンバー・迷宮スタブ）
   - EnhancedBSPBuilder統合（全機能を統合した拡張BSPシステム）
   - 階層別複雑度調整（浅い階層：シンプル → 深い階層：複雑）
   - 品質保証：単体テスト285/285、CLI統合テスト25/25成功

5. ✅ **階層難易度調整** (2025-07-18)
   - FloorDifficultyManager実装（5段階の難易度ティア・階層別パラメータ自動調整）
   - EnhancedItemSpawner実装（階層別アイテム生成・戦略的配置・特殊イベント対応）
   - EnhancedTrapSpawner実装（階層別トラップ生成・戦略的配置・8種類のトラップタイプ）
   - ComprehensiveDifficultySystem実装（包括的難易度分析・バランス調整・推奨事項生成）
   - 階層別難易度曲線最適化（初心者向け1-5F → エキスパート向け21-26F）
   - 品質保証：単体テスト289/289、CLI統合テスト25/25成功

6. ✅ **GUI/CLIモード統合修正** (2025-07-18)
   - GUIモードでのキー入力が完全に機能しない問題を修正
   - is_debug_mode関数の欠落によるimportエラー修正
   - GameStatesの重複インポート問題解決
   - Ctrlキーと通常キーの競合問題修正（t, w, s, rキー）
   - インベントリ画面でのキー入力処理修正（TCODキーシンボル問題）
   - ウィザードモード表示追加（[WIZARD]表示）
   - オリジナルRogue準拠のUI改善（現代的ヒント表示削除）
   - アイテム取得コマンド表示修正（gキー→,キー）
   - Q/qキーのポーション処理追加（GUI/CLI両対応）
   - Protocolsインスタンス化エラー修正
   - 品質保証：単体テスト285/285、CLI統合テスト25/25成功

7. ✅ **アイテムシステム調整** (2025-07-18)
   - 識別システム改善：ワンドの識別システム実装（20種類の材質名）
   - IDベースセーブ・ロード：全アイテムタイプの識別状態保存対応
   - 識別統計修正：ポーション・巻物・指輪・ワンド統計表示
   - 武器・防具バランス調整：オリジナルRogue準拠の効果値最適化
   - ポーション・巻物効果調整：効果値・出現頻度の適正化
   - アイテム出現頻度最適化：階層別生成・宝物部屋の豪華化
   - 幻覚モンスター情報追加：Dream Eater・Phantom Fungusのヘルプ対応
   - 品質保証：単体テスト285/285、CLI統合テスト25/25成功

### 次のマイルストーン
1. **モンスターAI改善**: 基本AI動作最適化・階層別調整
2. **システム機能拡張**: パフォーマンス最適化・バグ修正
3. **デバッグ・開発支援**: ウィザードモード拡張・分析ツール

---

**注意**: Phase 1の詳細な完了履歴は `docs/task-phase1.md` を参照してください。
