# PyRogue

Python 3.12とTCODライブラリを使用した**本格的なローグライクゲーム**です。オリジナルRogueの26階層構造を忠実に再現し、手続き生成ダンジョン、ターンベース戦闘、パーマデス、探索重視のゲームプレイを提供します。

## 完成状態

PyRogueは現在、**完全に機能する本格的なローグライクゲーム**として完成しています：

- ✅ **BSPダンジョン生成システム**（RogueBasin準拠・迷路階層システム含む）
- ✅ **高度なドア配置システム**（連続ドア防止・ランダム状態・戦術的配置）
- ✅ **トラップ探索・解除システム**（安全な発見・解除・レベル依存成功率）
- ✅ ターンベース戦闘・魔法・アイテムシステム
- ✅ 状態異常・トラップシステム（幻覚システム含む）
- ✅ 包括的なUI/UXとセーブ・ロード機能
- ✅ **ウィザードモード**（全マップ表示・無敵・デバッグ機能）
- ✅ 高品質なアーキテクチャ（責務分離、テスト可能性、拡張性）
- ✅ **NPCシステム**（実装済み・現在無効化中）
- ✅ **完全なPermadeathシステム**（真の一回限りのゲーム体験）
- ✅ **スコアランキングシステム**（成績記録・比較）
- ✅ **完全なアイテム識別システム**（オリジナルRogue風）
- ✅ **多様なモンスターAI**（逃走、特殊攻撃、分裂等）
- ✅ **強化された飢餓システム**（戦闘能力に影響するペナルティ）

## 特徴

### 🎯 **コアゲームプレイ**
- **BSPダンジョン生成**: RogueBasin準拠のBinary Space Partitioning
- **高度なドア配置**: 部屋境界突破判定・連続ドア防止・ランダム状態
- **トラップ探索・解除**: 安全な発見・解除システム（踏まずに処理）
- **ターンベース戦闘**: 戦略性の高い戦闘システム
- **パーマデス**: 永続的な死による真のローグライク体験
- **探索重視**: 隠し扉、トラップ、秘密の部屋
- **完全なアイテム識別**: オリジナルRogue風の未識別システム

### 🏗️ **高度なゲームシステム**
- **⭐NPCシステム**: 実装済み（現在無効化中・将来の拡張用）
- **⭐多様なモンスターAI**: 逃走、特殊攻撃、分裂、盗取等
- **⭐強化された飢餓システム**: 戦闘能力に影響するペナルティ
- **⭐幻覚システム**: 視覚混乱による表示変化
- **⭐スコアランキング**: 成績記録・比較システム
- **⭐完全なPermadeath**: 真の一回限りのゲーム体験

### 🔧 **技術的特徴**
- **CLI/GUIデュアルモード**: 開発効率とユーザビリティを両立
- **ウィザードモード**: 完全なデバッグ環境（可視化・無敵・操作機能）
- **包括的テスト**: 26個のテストファイル
- **高品質アーキテクチャ**: Builder Pattern、責務分離
- **完全な型ヒント**: 高い保守性と開発効率

## 技術スタック

- **Python 3.12**: 最新のPython機能を活用
- **TCOD >=19.0.0**: 描画、入力処理、視界計算
- **NumPy >=1.26.3**: 数値計算・配列操作
- **UV**: 高速パッケージ管理

## 必要条件

- Python 3.12
- uv (パッケージマネージャー)

## インストール

### 環境構築
```bash
# 初回セットアップ（仮想環境の作成と依存関係のインストール）
make setup

# 開発依存関係のインストール
make setup-dev
```

### ゲーム実行
```bash
# ゲーム実行（リリースモード）
make run

# デバッグモードでの実行
DEBUG=1 make run
```

## 開発者向け

### 開発ワークフロー
```bash
# テスト実行
make test

# CI検証（リント・型チェック・テスト）
make ci-checks
```

### 開発ツール
開発環境には以下のツールが含まれています：

- **ruff**: コードフォーマッター・リンター
- **mypy**: 型チェック
- **pytest**: テスト実行・カバレッジ計測

詳細な開発者向けガイドは[docs/development.md](docs/development.md)を参照してください。

## 操作方法

### 基本移動
- **Vi-keys**: hjkl + 対角線移動 (yubn)
- **矢印キー**: 標準的な方向移動
- **テンキー**: 1-9による移動（対角線含む）

### アクション
- **g**: アイテム取得
- **i**: インベントリ画面
- **w**: 装備画面
- **q**: アイテム使用
- **o**: 扉を開く
- **c**: 扉を閉じる
- **s**: 隠し扉の探索
- **d**: トラップ解除
- **z**: 魔法書（spellbook）
- **t**: NPCとの対話（現在無効化中）
- **Tab**: FOV表示切り替え
- **?**: ヘルプ

### セーブ・ロード
- **Ctrl+S**: ゲームセーブ
- **Ctrl+L**: ゲームロード

## アーキテクチャ概要

PyRogueは高品質なアーキテクチャを採用しています：

### 設計原則
- **責務分離**: 各クラスが単一責任を持つ
- **テスト可能性**: 依存関係注入、モックしやすい設計
- **拡張性**: 新機能の追加が容易
- **保守性**: 明確な型ヒント、包括的なドキュメント

### 主要コンポーネント
- **Core**: ゲームエンジン、状態管理、入力処理
- **Entities**: プレイヤー、モンスター、アイテム、魔法、トラップ
- **Map**: ダンジョン生成、タイル定義、階層管理
- **UI**: スクリーンシステム、描画処理、ユーザーインターフェース

### 設計パターン
- **Builder Pattern**: ダンジョン生成の段階的構築
- **Manager Pattern**: 機能を管理クラスに分割
- **State Pattern**: ゲーム状態の明確な管理
- **Command Pattern**: 状態異常・魔法効果の実行

詳細なアーキテクチャ情報は[docs/architecture.md](docs/architecture.md)を参照してください。
